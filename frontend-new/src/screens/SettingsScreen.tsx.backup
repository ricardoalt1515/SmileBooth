import { useState, useEffect, useRef } from 'react';
import { Settings, X, Check, Upload, ImageIcon, Trash2 } from 'lucide-react';
import { useAppStore } from '../store/useAppStore';
import { useToast as useToastContext } from '../contexts/ToastContext';
import photoboothAPI from '../services/api';
import { API_BASE_URL } from '../config/constants';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Slider } from '@/components/ui/slider';

interface Design {
  id: string;
  name: string;
  file_path: string;
  preview_url: string;
  is_active: boolean;
  created_at: string;
}

export default function SettingsScreen() {
  const {
    photosToTake,
    countdownSeconds,
    audioEnabled,
    voiceRate,
    voicePitch,
    voiceVolume,
    loadSettings,
    setCurrentScreen,
  } = useAppStore();

  const toast = useToastContext();
  const fileInputRef = useRef<HTMLInputElement>(null);

  // Tab state
  const [activeTab, setActiveTab] = useState<'general' | 'designs' | 'printing'>('general');

  // Local form state
  const [formData, setFormData] = useState({
    photos_to_take: photosToTake,
    countdown_seconds: countdownSeconds,
    audio_enabled: audioEnabled,
    voice_rate: voiceRate,
    voice_pitch: voicePitch,
    voice_volume: voiceVolume,
    auto_reset_seconds: 30, // Default
  });

  const [isSaving, setIsSaving] = useState(false);
  const [saveMessage, setSaveMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);

  // Designs state
  const [designs, setDesigns] = useState<Design[]>([]);
  const [isLoadingDesigns, setIsLoadingDesigns] = useState(false);
  const [isUploading, setIsUploading] = useState(false);

  // Printing state
  const [printers, setPrinters] = useState<string[]>([]);
  const [defaultPrinter, setDefaultPrinter] = useState<string | null>(null);
  const [selectedPrinter, setSelectedPrinter] = useState<string | null>(null);
  const [isLoadingPrinters, setIsLoadingPrinters] = useState(false);
  const [isTesting, setIsTesting] = useState(false);

  // Dialog states
  const [showResetDialog, setShowResetDialog] = useState(false);
  const [showDeleteDialog, setShowDeleteDialog] = useState(false);
  const [designToDelete, setDesignToDelete] = useState<string | null>(null);

  // Handle ESC key to close
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === 'Escape') {
        handleBack();
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, []);

  // Load settings from backend on mount
  useEffect(() => {
    const fetchSettings = async () => {
      try {
        const settings = await photoboothAPI.settings.get();
        setFormData({
          photos_to_take: settings.photos_to_take,
          countdown_seconds: settings.countdown_seconds,
          audio_enabled: settings.audio_enabled,
          voice_rate: settings.voice_rate,
          voice_pitch: settings.voice_pitch,
          voice_volume: settings.voice_volume,
          auto_reset_seconds: settings.auto_reset_seconds || 30,
        });
      } catch (error) {
        console.error('Error loading settings:', error);
        setSaveMessage({ type: 'error', text: 'Error cargando configuraci√≥n' });
      }
    };

    fetchSettings();
  }, []);

  // Load designs when switching to designs tab
  useEffect(() => {
    if (activeTab === 'designs') {
      loadDesigns();
    }
  }, [activeTab]);

  // Load printers when switching to printing tab
  useEffect(() => {
    if (activeTab === 'printing') {
      loadPrinters();
    }
  }, [activeTab]);

  // Guardar impresora cuando cambia la selecci√≥n
  useEffect(() => {
    const savePrinter = async () => {
      if (selectedPrinter && selectedPrinter !== defaultPrinter) {
        try {
          await photoboothAPI.settings.update({ default_printer: selectedPrinter });
          toast.success('Impresora guardada: ' + selectedPrinter);
        } catch (error) {
          console.error('Error saving printer:', error);
          toast.error('Error al guardar impresora');
        }
      }
    };
    
    // Solo guardar si ya cargamos las impresoras (no en mount inicial)
    if (printers.length > 0 && selectedPrinter) {
      savePrinter();
    }
  }, [selectedPrinter]);

  const loadDesigns = async () => {
    setIsLoadingDesigns(true);
    try {
      const data = await photoboothAPI.designs.list();
      setDesigns(data.designs);
    } catch (error) {
      console.error('Error loading designs:', error);
      toast.error('Error cargando dise√±os');
    } finally {
      setIsLoadingDesigns(false);
    }
  };

  const loadPrinters = async () => {
    setIsLoadingPrinters(true);
    try {
      const data = await photoboothAPI.print.listPrinters();
      setPrinters(data.printers);
      setDefaultPrinter(data.default_printer);
      setSelectedPrinter(data.default_printer);
    } catch (error) {
      console.error('Error loading printers:', error);
      toast.error('Error cargando impresoras');
    } finally {
      setIsLoadingPrinters(false);
    }
  };

  const handleTestPrint = async () => {
    if (!selectedPrinter) {
      toast.warning('Selecciona una impresora primero');
      return;
    }

    setIsTesting(true);
    try {
      // Crear una imagen de prueba simple
      const testMessage = `Test de impresi√≥n\nImpresora: ${selectedPrinter}\nFecha: ${new Date().toLocaleString()}`;
      toast.info('Enviando test de impresi√≥n...');
      
      // Aqu√≠ podr√≠as enviar un archivo de test real
      // Por ahora solo mostramos el mensaje
      toast.success('Test enviado a ' + selectedPrinter);
    } catch (error) {
      console.error('Error testing printer:', error);
      toast.error('Error en test de impresi√≥n');
    } finally {
      setIsTesting(false);
    }
  };

  const handleFileSelect = async (file: File) => {
    if (!file.type.startsWith('image/')) {
      toast.error('Solo se permiten im√°genes PNG o JPG');
      return;
    }

    setIsUploading(true);
    try {
      await photoboothAPI.designs.upload(file, file.name);
      toast.success('Dise√±o subido correctamente');
      await loadDesigns();
    } catch (error) {
      console.error('Error uploading design:', error);
      toast.error('Error al subir dise√±o');
    } finally {
      setIsUploading(false);
    }
  };

  const handleFileInput = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      handleFileSelect(file);
    }
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    const file = e.dataTransfer.files?.[0];
    if (file) {
      handleFileSelect(file);
    }
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
  };

  const handleActivateDesign = async (designId: string) => {
    try {
      await photoboothAPI.designs.setActive(designId);
      toast.success('Dise√±o activado');
      await loadDesigns();
    } catch (error) {
      console.error('Error activating design:', error);
      toast.error('Error al activar dise√±o');
    }
  };

  const handleDeleteDesign = async (designId: string) => {
    if (!confirm('¬øEliminar este dise√±o?')) return;

    try {
      await photoboothAPI.designs.delete(designId);
      toast.success('Dise√±o eliminado');
      await loadDesigns();
    } catch (error) {
      console.error('Error deleting design:', error);
      toast.error('Error al eliminar dise√±o');
    }
  };

  const handleSave = async () => {
    setIsSaving(true);
    setSaveMessage(null);

    try {
      const updatedSettings = await photoboothAPI.settings.update(formData);
      loadSettings(updatedSettings);
      setSaveMessage({ type: 'success', text: '‚úÖ Configuraci√≥n guardada' });

      // Auto-hide success message
      setTimeout(() => setSaveMessage(null), 3000);
    } catch (error) {
      console.error('Error saving settings:', error);
      setSaveMessage({ type: 'error', text: '‚ùå Error guardando configuraci√≥n' });
    } finally {

    {/* Header */}
    <div className="max-w-2xl mx-auto">
      <div className="flex items-center gap-4 mb-8">
        <Settings className="w-8 h-8 text-[#ff0080]" />
        <h1 className="text-3xl font-bold">Configuraci√≥n</h1>
      </div>

      {/* Tabs Navigation */}
      <div className="flex gap-2 mb-8 border-b border-gray-700">
        <button
          onClick={() => setActiveTab('general')}
          className={`px-6 py-3 font-medium transition-all duration-200 ${
            activeTab === 'general'
              ? 'text-[#ff0080] border-b-2 border-[#ff0080]'
              : 'text-gray-400 hover:text-white'
          }`}
        >
          ‚öôÔ∏è General
        </button>
        <button
          onClick={() => setActiveTab('designs')}
          className={`px-6 py-3 font-medium transition-all duration-200 ${
            activeTab === 'designs'
              ? 'text-[#ff0080] border-b-2 border-[#ff0080]'
              : 'text-gray-400 hover:text-white'
          }`}
        >
          üé® Dise√±os Canva
        </button>
        <button
          onClick={() => setActiveTab('printing')}
          className={`px-6 py-3 font-medium transition-all duration-200 ${
            activeTab === 'printing'
              ? 'text-[#ff0080] border-b-2 border-[#ff0080]'
              : 'text-gray-400 hover:text-white'
          }`}
        >
          üñ®Ô∏è Impresi√≥n
        </button>
      </div>

      {/* Save message */}
      {saveMessage && (
        <div
          className={`mb-6 p-4 rounded-lg ${
            saveMessage.type === 'success'
              ? 'bg-green-600/20 text-green-400 border border-green-600'
              : 'bg-red-600/20 text-red-400 border border-red-600'
          }`}
        >
          {saveMessage.text}

      {/* Header */}
      <div className="max-w-2xl mx-auto">
        <div className="flex items-center gap-4 mb-8">
          <Settings className="w-8 h-8 text-[#ff0080]" />
          <h1 className="text-3xl font-bold">Configuraci√≥n</h1>
        </div>

        {/* Tabs Navigation */}
        <div className="flex gap-2 mb-8 border-b border-gray-700">
          <button
            onClick={() => setActiveTab('general')}
            className={`px-6 py-3 font-medium transition-all duration-200 ${
              activeTab === 'general'
                ? 'text-[#ff0080] border-b-2 border-[#ff0080]'
                : 'text-gray-400 hover:text-white'
            }`}
          >
            ‚öôÔ∏è General
          </button>
          <button
            onClick={() => setActiveTab('designs')}
            className={`px-6 py-3 font-medium transition-all duration-200 ${
              activeTab === 'designs'
                ? 'text-[#ff0080] border-b-2 border-[#ff0080]'
                : 'text-gray-400 hover:text-white'
            }`}
          >
            üé® Dise√±os Canva
          </button>
          <button
            onClick={() => setActiveTab('printing')}
            className={`px-6 py-3 font-medium transition-all duration-200 ${
              activeTab === 'printing'
                ? 'text-[#ff0080] border-b-2 border-[#ff0080]'
                : 'text-gray-400 hover:text-white'
            }`}
          >
            üñ®Ô∏è Impresi√≥n
          </button>
        </div>

        {/* Save message */}
        {saveMessage && (
          <div
            className={`mb-6 p-4 rounded-lg ${
              saveMessage.type === 'success'
                ? 'bg-green-600/20 text-green-400 border border-green-600'
                : 'bg-red-600/20 text-red-400 border border-red-600'
            }`}
          >
            {saveMessage.text}
          </div>
        )}

        {/* Tab Content: General */}
        {activeTab === 'general' && (
        <div className="space-y-8">{/* Form */}
        <div className="space-y-8">
          {/* Photos to Take */}
          <div>
            <label className="block text-lg font-medium mb-4">
              N√∫mero de Fotos
            </label>
            <div className="flex items-center gap-6">
              <input
                type="range"
                min="1"
                max="6"
                value={formData.photos_to_take}
                onChange={(e) =>
                  setFormData({ ...formData, photos_to_take: parseInt(e.target.value) })
                }
                className="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#ff0080]"
              />
              <span className="text-4xl font-bold text-[#ff0080] w-16 text-center">
                {formData.photos_to_take}
              </span>
            </div>
            <p className="text-sm text-gray-400 mt-2">Fotos por sesi√≥n (1-6)</p>
          </div>

          {/* Countdown Duration */}
          <div>
            <label className="block text-lg font-medium mb-4">
              Duraci√≥n del Countdown
            </label>
            <div className="flex items-center gap-6">
              <input
                type="range"
                min="3"
                max="10"
                value={formData.countdown_seconds}
                onChange={(e) =>
                  setFormData({ ...formData, countdown_seconds: parseInt(e.target.value) })
                }
                className="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#ff0080]"
              />
              <span className="text-4xl font-bold text-[#ff0080] w-16 text-center">
                {formData.countdown_seconds}s
              </span>
            </div>
            <p className="text-sm text-gray-400 mt-2">Segundos de cuenta regresiva (3-10)</p>
          </div>

          {/* Audio Enabled */}
          <div>
            <label className="flex items-center justify-between p-4 bg-gray-800/50 rounded-lg cursor-pointer hover:bg-gray-800/70">
              <span className="text-lg font-medium">Audio Habilitado</span>
              <input
                type="checkbox"
                checked={formData.audio_enabled}
                onChange={(e) =>
                  setFormData({ ...formData, audio_enabled: e.target.checked })
                }
                className="w-6 h-6 accent-[#ff0080] cursor-pointer"
              />
            </label>
            <p className="text-sm text-gray-400 mt-2">Activar/desactivar voz y efectos de sonido</p>
          </div>

          {/* Voice Rate */}
          {formData.audio_enabled && (
            <>
              <div>
                <label className="block text-lg font-medium mb-4">
                  Velocidad de Voz
                </label>
                <div className="flex items-center gap-6">
                  <input
                    type="range"
                    min="0.5"
                    max="2"
                    step="0.1"
                    value={formData.voice_rate}
                    onChange={(e) =>
                      setFormData({ ...formData, voice_rate: parseFloat(e.target.value) })
                    }
                    className="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#ff0080]"
                  />
                  <span className="text-2xl font-bold text-[#ff0080] w-20 text-center">
                    {formData.voice_rate.toFixed(1)}x
                  </span>
                </div>
                <p className="text-sm text-gray-400 mt-2">Velocidad de texto a voz (0.5-2.0)</p>
              </div>

              {/* Voice Pitch */}
              <div>
                <label className="block text-lg font-medium mb-4">
                  Tono de Voz
                </label>
                <div className="flex items-center gap-6">
                  <input
                    type="range"
                    min="0.5"
                    max="2"
                    step="0.1"
                    value={formData.voice_pitch}
                    onChange={(e) =>
                      setFormData({ ...formData, voice_pitch: parseFloat(e.target.value) })
                    }
                    className="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#ff0080]"
                  />
                  <span className="text-2xl font-bold text-[#ff0080] w-20 text-center">
                    {formData.voice_pitch.toFixed(1)}x
                  </span>
                </div>
                <p className="text-sm text-gray-400 mt-2">Altura del tono (0.5-2.0)</p>
              </div>

              {/* Voice Volume */}
              <div>
                <label className="block text-lg font-medium mb-4">
                  Volumen de Voz
                </label>
                <div className="flex items-center gap-6">
                  <input
                    type="range"
                    min="0"
                    max="1"
                    step="0.1"
                    value={formData.voice_volume}
                    onChange={(e) =>
                      setFormData({ ...formData, voice_volume: parseFloat(e.target.value) })
                    }
                    className="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#ff0080]"
                  />
                  <span className="text-2xl font-bold text-[#ff0080] w-20 text-center">
                    {Math.round(formData.voice_volume * 100)}%
                  </span>
                </div>
                <p className="text-sm text-gray-400 mt-2">Volumen del audio (0-100%)</p>
              </div>
            </>
          )}
        </div>

        {/* Action Buttons - General Tab */}
        <div className="mt-12 flex gap-4">
          <button
            onClick={handleBack}
            className="flex-1 h-20 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg transition-all"
          >
            Volver a Cabina
          </button>
          <button
            onClick={handleReset}
            disabled={isSaving}
            className="flex-1 h-20 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Restaurar Defaults
          </button>
          <button
            onClick={handleSave}
            disabled={isSaving}
            className="flex-1 h-20 bg-[#ff0080] hover:bg-[#ff0080]/80 text-white font-bold rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {isSaving ? 'Guardando...' : 'Guardar'}
          </button>
        </div>
        </div>
        )}

        {/* Tab Content: Designs */}
        {activeTab === 'designs' && (
          <div className="space-y-8">
            {/* Upload Zone */}
            <div
              onDrop={handleDrop}
              onDragOver={handleDragOver}
              className="border-2 border-dashed border-gray-600 rounded-xl p-12 text-center cursor-pointer hover:border-[#ff0080] hover:bg-gray-900/50 transition-all duration-300"
              onClick={() => fileInputRef.current?.click()}
            >
              <Upload className="w-16 h-16 mx-auto mb-4 text-gray-400" />
              <p className="text-xl font-medium mb-2">Arrastra un dise√±o de Canva aqu√≠</p>
              <p className="text-sm text-gray-400 mb-4">o haz click para seleccionar</p>
              <p className="text-xs text-gray-500">PNG o JPG - 600x450px recomendado</p>
              <input
                ref={fileInputRef}
                type="file"
                accept="image/png,image/jpeg,image/jpg"
                onChange={handleFileInput}
                className="hidden"
              />
              {isUploading && (
                <div className="mt-4">
                  <div className="inline-block w-6 h-6 border-2 border-[#ff0080] border-t-transparent rounded-full animate-spin" />
                  <p className="text-sm text-gray-400 mt-2">Subiendo...</p>
                </div>
              )}
            </div>

            {/* Designs Grid */}
            {isLoadingDesigns ? (
              <div className="text-center py-12">
                <div className="inline-block w-8 h-8 border-2 border-[#ff0080] border-t-transparent rounded-full animate-spin" />
                <p className="text-gray-400 mt-4">Cargando dise√±os...</p>
              </div>
            ) : designs.length === 0 ? (
              <div className="text-center py-12 text-gray-400">
                <ImageIcon className="w-16 h-16 mx-auto mb-4 opacity-50" />
                <p className="text-lg">No hay dise√±os disponibles</p>
                <p className="text-sm mt-2">Sube tu primer dise√±o de Canva</p>
              </div>
            ) : (
              <div>
                <h3 className="text-xl font-bold mb-4">Dise√±os Disponibles ({designs.length})</h3>
                <div className="grid grid-cols-2 gap-6">
                  {designs.map((design) => (
                    <div
                      key={design.id}
                      className={`relative rounded-xl overflow-hidden border-2 transition-all duration-300 ${
                        design.is_active
                          ? 'border-[#ff0080] ring-4 ring-[#ff0080]/30 shadow-xl shadow-[#ff0080]/20'
                          : 'border-gray-700 hover:border-gray-600'
                      }`}
                    >
                      {/* Preview Image */}
                      <div className="aspect-[4/3] bg-gray-900">
                        <img
                          src={`${API_BASE_URL}${design.preview_url}`}
                          alt={design.name}
                          className="w-full h-full object-contain"
                        />
                      </div>

                      {/* Active Badge */}
                      {design.is_active && (
                        <div className="absolute top-3 right-3 bg-[#ff0080] text-white px-3 py-1 rounded-full text-sm font-bold flex items-center gap-1">
                          <Check className="w-4 h-4" />
                          Activo
                        </div>
                      )}

                      {/* Info & Actions */}
                      <div className="p-4 bg-gray-800/50">
                        <p className="text-sm font-medium truncate mb-3">{design.name}</p>
                        <div className="flex gap-2">
                          <button
                            onClick={() => handleActivateDesign(design.id)}
                            disabled={design.is_active}
                            className={`flex-1 py-2 rounded-lg font-medium transition-all ${
                              design.is_active
                                ? 'bg-gray-700 text-gray-500 cursor-not-allowed'
                                : 'bg-[#ff0080] hover:bg-[#ff0080]/80 text-white'
                            }`}
                          >
                            {design.is_active ? 'Activo' : 'Activar'}
                          </button>
                          <button
                            onClick={() => handleDeleteDesign(design.id)}
                            className="px-4 py-2 bg-red-600/20 hover:bg-red-600/40 text-red-400 rounded-lg transition-all"
                            title="Eliminar dise√±o"
                          >
                            <Trash2 className="w-4 h-4" />
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Info Box */}
            <div className="bg-blue-600/10 border border-blue-600/30 rounded-lg p-6">
              <h4 className="font-bold text-blue-400 mb-2">üí° C√≥mo usar dise√±os de Canva</h4>
              <ul className="text-sm text-gray-300 space-y-1">
                <li>1. Crea tu dise√±o en Canva (600x450px)</li>
                <li>2. Exporta como PNG o JPG</li>
                <li>3. Arrastra el archivo aqu√≠ o haz click para seleccionar</li>
                <li>4. Activa el dise√±o que quieras usar</li>
                <li>5. El dise√±o aparecer√° al final de cada tira de fotos</li>
              </ul>
            </div>

            {/* Back Button */}
            <div className="mt-8">
              <button
                onClick={handleBack}
                className="w-full h-16 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg transition-all"
              >
                Volver a Cabina
              </button>
            </div>
          </div>
        )}

        {/* Tab Content: Printing */}
        {activeTab === 'printing' && (
          <div className="space-y-8">
            {/* Printer Selection */}
            {isLoadingPrinters ? (
              <div className="text-center py-12">
                <div className="inline-block w-8 h-8 border-2 border-[#ff0080] border-t-transparent rounded-full animate-spin" />
                <p className="text-gray-400 mt-4">Cargando impresoras...</p>
              </div>
            ) : printers.length === 0 ? (
              <div className="text-center py-12 text-gray-400">
                <p className="text-lg">No se detectaron impresoras</p>
                <p className="text-sm mt-2">Conecta una impresora e intenta de nuevo</p>
              </div>
            ) : (
              <div>
                <h3 className="text-xl font-bold mb-4">Impresora Predeterminada</h3>
                <div className="space-y-3">
                  {printers.map((printer) => (
                    <label
                      key={printer}
                      className={`flex items-center gap-4 p-4 rounded-lg border-2 cursor-pointer transition-all ${
                        selectedPrinter === printer
                          ? 'border-[#ff0080] bg-[#ff0080]/10'
                          : 'border-gray-700 hover:border-gray-600'
                      }`}
                    >
                      <input
                        type="radio"
                        name="printer"
                        checked={selectedPrinter === printer}
                        onChange={() => setSelectedPrinter(printer)}
                        className="w-5 h-5 text-[#ff0080]"
                      />
                      <div className="flex-1">
                        <p className="font-medium">{printer}</p>
                        {printer === defaultPrinter && (
                          <p className="text-sm text-gray-400">Predeterminada del sistema</p>
                        )}
                      </div>
                      {selectedPrinter === printer && (
                        <Check className="w-5 h-5 text-[#ff0080]" />
                      )}
                    </label>
                  ))}
                </div>
              </div>
            )}

            {/* Test Print Button */}
            {printers.length > 0 && (
              <div>
                <button
                  onClick={handleTestPrint}
                  disabled={isTesting || !selectedPrinter}
                  className="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {isTesting ? 'Enviando test...' : 'üñ®Ô∏è Test de Impresi√≥n'}
                </button>
                <p className="text-sm text-gray-400 mt-2 text-center">
                  Imprime una p√°gina de prueba para verificar la impresora
                </p>
              </div>
            )}

            {/* Info Box */}
            <div className="bg-blue-600/10 border border-blue-600/30 rounded-lg p-6">
              <h4 className="font-bold text-blue-400 mb-2">üí° Sobre la impresi√≥n</h4>
              <ul className="text-sm text-gray-300 space-y-1">
                <li>‚Ä¢ El sistema imprime 2 tiras id√©nticas en una hoja 4x6"</li>
                <li>‚Ä¢ El cliente corta por la mitad para obtener 2 tiras</li>
                <li>‚Ä¢ Cada tira incluye 3 fotos + dise√±o Canva (si est√° activo)</li>
                <li>‚Ä¢ Aseg√∫rate de tener papel fotogr√°fico 4x6" (10x15cm)</li>
              </ul>
            </div>

            {/* Auto-reset Setting */}
            <div className="border-t border-gray-700 pt-8">
              <h3 className="text-xl font-bold mb-4">Auto-reset</h3>
              <div>
                <label className="block text-lg font-medium mb-4">
                  Reiniciar autom√°ticamente despu√©s de
                </label>
                <div className="flex items-center gap-6">
                  <input
                    type="range"
                    min="10"
                    max="60"
                    step="5"
                    value={formData.auto_reset_seconds}
                    onChange={(e) =>
                      setFormData({ ...formData, auto_reset_seconds: parseInt(e.target.value) })
                    }
                    className="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#ff0080]"
                  />
                  <span className="text-2xl font-bold text-[#ff0080] w-24 text-center">
                    {formData.auto_reset_seconds}s
                  </span>
                </div>
                <p className="text-sm text-gray-400 mt-2">
                  Tiempo antes de volver autom√°ticamente a la pantalla inicial (10-60 segundos)
                </p>
              </div>
            </div>

            {/* Back Button */}
            <div className="mt-8">
              <button
                onClick={handleBack}
                className="w-full h-16 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-lg transition-all"
              >
                Volver a Cabina
              </button>
            </div>
          </div>
        )}

        {/* Keyboard Hint */}
        <p className="text-center text-sm text-gray-500 mt-8">
          Presiona <kbd className="px-2 py-1 bg-gray-800 rounded">Ctrl+Shift+S</kbd> o <kbd className="px-2 py-1 bg-gray-800 rounded">ESC</kbd> para cerrar
        </p>
      </div>
    </div>
  );
}
