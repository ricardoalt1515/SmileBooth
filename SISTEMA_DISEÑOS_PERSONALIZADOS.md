# Sistema de Dise√±os Personalizados por Evento
**Como tu ejemplo "LIZ"** | Noviembre 2025

---

## üé® Visi√≥n General

Basado en tu imagen, el sistema permite:
- ‚úÖ 3 fotos en la parte superior/media
- ‚úÖ **Dise√±o personalizado en la parte inferior** (footer)
- ‚úÖ Cada evento tiene su propio dise√±o
- ‚úÖ Cambio r√°pido entre dise√±os

---

## üìê Anatom√≠a de una Tira con Dise√±o

### Tu Ejemplo "LIZ"

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 ‚îÇ
‚îÇ    FOTO 1       ‚îÇ ‚Üê 550x413px (3 fotos)
‚îÇ                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                 ‚îÇ
‚îÇ    FOTO 2       ‚îÇ ‚Üê 550x413px
‚îÇ                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                 ‚îÇ
‚îÇ    FOTO 3       ‚îÇ ‚Üê 550x413px
‚îÇ                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÄ‚îê
‚îÇ                 ‚îÇ   ‚îÇ
‚îÇ   Fondo azul    ‚îÇ   ‚îÇ 600x450px
‚îÇ   con splash    ‚îÇ   ‚îÇ DISE√ëO
‚îÇ                 ‚îÇ   ‚îÇ CUSTOM
‚îÇ      LIZ        ‚îÇ   ‚îÇ (tu archivo)
‚îÇ                 ‚îÇ   ‚îÇ
‚îÇ   ‚òÖ  ‚òÖ  ‚òÖ       ‚îÇ   ‚îÇ
‚îÇ                 ‚îÇ  ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Total: 600x1800px @ 300 DPI
```

---

## üé® C√≥mo Crear Dise√±os Personalizados

### Especificaciones T√©cnicas

**Tama√±o del dise√±o footer:**
- Ancho: 600 p√≠xeles (2 pulgadas @ 300 DPI)
- Alto: 450 p√≠xeles (~1.5 pulgadas)
- Formato: PNG con transparencia o JPG
- Resoluci√≥n: 300 DPI

**Software recomendado:**
- Photoshop
- Canva Pro
- Figma
- GIMP (gratis)
- Procreate (iPad)

### Template Base para Dise√±adores

```
Dimensiones: 600x450px @ 300 DPI

√Åreas de seguridad:
- Margen exterior: 20px (contenido importante)
- Zona de texto principal: Centro vertical
- Decoraciones: Pueden llegar hasta el borde

Elementos comunes:
- Nombre del evento (grande, centrado)
- Fecha (opcional)
- Decoraciones tem√°ticas
- Gradientes o fondos s√≥lidos
- Iconos/stickers tem√°ticos
```

---

## üìÇ Organizaci√≥n de Dise√±os

### Estructura de Carpetas

```
data/designs/
‚îú‚îÄ‚îÄ xv_anos/
‚îÇ   ‚îú‚îÄ‚îÄ liz_design.png
‚îÇ   ‚îú‚îÄ‚îÄ sofia_xv.png
‚îÇ   ‚îî‚îÄ‚îÄ maria_quince.png
‚îÇ
‚îú‚îÄ‚îÄ san_valentin/
‚îÇ   ‚îú‚îÄ‚îÄ amor_2025.png
‚îÇ   ‚îú‚îÄ‚îÄ corazones_clasico.png
‚îÇ   ‚îî‚îÄ‚îÄ romantico_moderno.png
‚îÇ
‚îú‚îÄ‚îÄ bodas/
‚îÇ   ‚îú‚îÄ‚îÄ maria_juan.png
‚îÇ   ‚îú‚îÄ‚îÄ elegant_gold.png
‚îÇ   ‚îî‚îÄ‚îÄ rustic_wedding.png
‚îÇ
‚îú‚îÄ‚îÄ cumpleanos/
‚îÇ   ‚îú‚îÄ‚îÄ birthday_confetti.png
‚îÇ   ‚îî‚îÄ‚îÄ kids_party.png
‚îÇ
‚îî‚îÄ‚îÄ custom/
    ‚îî‚îÄ‚îÄ evento_personalizado.png
```

### Base de Datos de Dise√±os

```sql
CREATE TABLE designs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100) NOT NULL,
    category VARCHAR(50),  -- xv_anos, bodas, san_valentin, etc.
    file_path VARCHAR(255) NOT NULL,
    preview_path VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT FALSE
);

-- Solo un dise√±o activo a la vez
CREATE UNIQUE INDEX idx_active_design ON designs(is_active) WHERE is_active = TRUE;
```

---

## üíª Implementaci√≥n Backend (Python + Pillow)

### Funci√≥n Principal: Agregar Dise√±o a Tira

```python
from PIL import Image
from typing import Optional

def compose_strip_with_design(
    photo_paths: list[str],
    design_path: str,
    output_path: str
) -> str:
    """
    Crea una tira de 3 fotos con dise√±o personalizado en el footer.
    
    Args:
        photo_paths: Lista de 3 rutas a fotos
        design_path: Ruta al dise√±o personalizado (600x450px)
        output_path: Ruta donde guardar la tira final
    
    Returns:
        str: Ruta de la tira generada
    """
    
    # Dimensiones
    STRIP_WIDTH = 600
    STRIP_HEIGHT = 1800
    PHOTO_HEIGHT = 413  # 3 fotos = 1239px
    DESIGN_HEIGHT = 450
    SPACING = 5  # Espaciado entre fotos
    
    # Crear canvas blanco
    strip = Image.new('RGB', (STRIP_WIDTH, STRIP_HEIGHT), 'white')
    
    # Y offset inicial (con margen superior)
    y_offset = 30
    
    # 1. Agregar las 3 fotos
    for photo_path in photo_paths:
        photo = Image.open(photo_path)
        
        # Redimensionar y recortar foto para 600x413
        photo_processed = resize_and_crop(photo, STRIP_WIDTH - 50, PHOTO_HEIGHT)
        
        # Centrar horizontalmente
        x_pos = (STRIP_WIDTH - photo_processed.width) // 2
        
        # Pegar foto
        strip.paste(photo_processed, (x_pos, y_offset))
        
        # Siguiente foto
        y_offset += PHOTO_HEIGHT + SPACING
    
    # 2. Agregar dise√±o personalizado en el footer
    design = Image.open(design_path)
    
    # Redimensionar dise√±o si es necesario (mantener 600x450)
    if design.size != (STRIP_WIDTH, DESIGN_HEIGHT):
        design = design.resize(
            (STRIP_WIDTH, DESIGN_HEIGHT),
            Image.Resampling.LANCZOS
        )
    
    # Pegar dise√±o al final
    design_y = STRIP_HEIGHT - DESIGN_HEIGHT
    
    # Si el dise√±o tiene transparencia (PNG), componer correctamente
    if design.mode == 'RGBA':
        # Crear fondo blanco
        bg = Image.new('RGB', design.size, 'white')
        bg.paste(design, (0, 0), design)
        strip.paste(bg, (0, design_y))
    else:
        strip.paste(design, (0, design_y))
    
    # 3. Guardar
    strip.save(output_path, quality=95, dpi=(300, 300))
    
    return output_path


def resize_and_crop(image: Image.Image, target_width: int, target_height: int) -> Image.Image:
    """Redimensiona y recorta imagen para llenar el espacio exacto."""
    img_ratio = image.width / image.height
    target_ratio = target_width / target_height
    
    if img_ratio > target_ratio:
        # Imagen m√°s ancha
        new_height = target_height
        new_width = int(new_height * img_ratio)
    else:
        # Imagen m√°s alta
        new_width = target_width
        new_height = int(new_width / img_ratio)
    
    # Redimensionar
    resized = image.resize((new_width, new_height), Image.Resampling.LANCZOS)
    
    # Recortar al centro
    left = (new_width - target_width) // 2
    top = (new_height - target_height) // 2
    right = left + target_width
    bottom = top + target_height
    
    return resized.crop((left, top, right, bottom))


# Ejemplo de uso
if __name__ == "__main__":
    photos = [
        "data/photos/session_001/photo_1.jpg",
        "data/photos/session_001/photo_2.jpg",
        "data/photos/session_001/photo_3.jpg"
    ]
    
    design = "data/designs/xv_anos/liz_design.png"
    output = "data/strips/session_001_final.jpg"
    
    strip_path = compose_strip_with_design(photos, design, output)
    print(f"‚úÖ Tira creada: {strip_path}")
```

---

## üñ•Ô∏è API Endpoints

### Upload Dise√±o

```python
from fastapi import APIRouter, UploadFile, File
from pathlib import Path
import shutil
from datetime import datetime

router = APIRouter(prefix="/api/designs", tags=["designs"])

@router.post("/upload")
async def upload_design(
    file: UploadFile = File(...),
    name: str = None,
    category: str = "custom"
):
    """
    Sube un dise√±o personalizado.
    
    Pasos:
    1. Validar que sea imagen (PNG/JPG)
    2. Validar dimensiones (600x450px recomendado)
    3. Guardar en carpeta correspondiente
    4. Crear thumbnail para preview
    5. Registrar en base de datos
    """
    
    # Validar formato
    if not file.content_type.startswith("image/"):
        raise HTTPException(400, "Solo se permiten im√°genes")
    
    # Generar nombre √∫nico
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    ext = Path(file.filename).suffix
    filename = f"{category}_{timestamp}{ext}"
    
    # Ruta de guardado
    category_path = Path(f"data/designs/{category}")
    category_path.mkdir(parents=True, exist_ok=True)
    
    file_path = category_path / filename
    
    # Guardar archivo
    with file_path.open("wb") as buffer:
        shutil.copyfileobj(file.file, buffer)
    
    # Validar/ajustar dimensiones
    from PIL import Image
    img = Image.open(file_path)
    
    if img.size != (600, 450):
        # Redimensionar si es necesario
        img_resized = img.resize((600, 450), Image.Resampling.LANCZOS)
        img_resized.save(file_path)
    
    # Crear thumbnail para preview (200x150)
    thumb = img.resize((200, 150), Image.Resampling.LANCZOS)
    thumb_path = category_path / f"thumb_{filename}"
    thumb.save(thumb_path)
    
    # Guardar en base de datos
    design = Design(
        name=name or file.filename,
        category=category,
        file_path=str(file_path),
        preview_path=str(thumb_path)
    )
    db.add(design)
    db.commit()
    
    return {
        "success": True,
        "design_id": design.id,
        "file_path": str(file_path),
        "preview_url": f"/api/designs/preview/{design.id}"
    }


@router.get("/list")
async def list_designs(category: str = None):
    """Lista todos los dise√±os disponibles."""
    query = db.query(Design)
    
    if category:
        query = query.filter(Design.category == category)
    
    designs = query.order_by(Design.created_at.desc()).all()
    
    return {
        "designs": [
            {
                "id": d.id,
                "name": d.name,
                "category": d.category,
                "preview_url": f"/api/designs/preview/{d.id}",
                "is_active": d.is_active
            }
            for d in designs
        ]
    }


@router.put("/set-active/{design_id}")
async def set_active_design(design_id: int):
    """Activa un dise√±o para usar en las pr√≥ximas sesiones."""
    
    # Desactivar todos
    db.query(Design).update({"is_active": False})
    
    # Activar el seleccionado
    design = db.query(Design).filter(Design.id == design_id).first()
    
    if not design:
        raise HTTPException(404, "Dise√±o no encontrado")
    
    design.is_active = True
    db.commit()
    
    return {
        "success": True,
        "active_design": {
            "id": design.id,
            "name": design.name,
            "file_path": design.file_path
        }
    }


@router.get("/active")
async def get_active_design():
    """Obtiene el dise√±o actualmente activo."""
    design = db.query(Design).filter(Design.is_active == True).first()
    
    if not design:
        return {"active_design": None}
    
    return {
        "active_design": {
            "id": design.id,
            "name": design.name,
            "file_path": design.file_path
        }
    }
```

---

## üé® UI: Panel de Gesti√≥n de Dise√±os

### Pantalla Settings ‚Üí Dise√±os

```tsx
// DesignManager.tsx
import { useState, useEffect } from 'react';

interface Design {
  id: number;
  name: string;
  category: string;
  preview_url: string;
  is_active: boolean;
}

export function DesignManager() {
  const [designs, setDesigns] = useState<Design[]>([]);
  const [uploading, setUploading] = useState(false);

  useEffect(() => {
    loadDesigns();
  }, []);

  const loadDesigns = async () => {
    const response = await fetch('http://localhost:8000/api/designs/list');
    const data = await response.json();
    setDesigns(data.designs);
  };

  const uploadDesign = async (file: File, category: string) => {
    setUploading(true);
    
    const formData = new FormData();
    formData.append('file', file);
    formData.append('name', file.name);
    formData.append('category', category);

    const response = await fetch('http://localhost:8000/api/designs/upload', {
      method: 'POST',
      body: formData,
    });

    if (response.ok) {
      await loadDesigns();
    }
    
    setUploading(false);
  };

  const setActive = async (designId: number) => {
    await fetch(`http://localhost:8000/api/designs/set-active/${designId}`, {
      method: 'PUT',
    });
    await loadDesigns();
  };

  return (
    <div className="design-manager">
      <h2>Dise√±os Personalizados</h2>

      {/* Upload Section */}
      <div className="upload-section">
        <h3>Subir Nuevo Dise√±o</h3>
        <input
          type="file"
          accept="image/png,image/jpeg"
          onChange={(e) => {
            const file = e.target.files?.[0];
            if (file) {
              uploadDesign(file, 'custom');
            }
          }}
        />
        <p className="hint">
          Tama√±o recomendado: 600x450px @ 300 DPI
        </p>
      </div>

      {/* Gallery */}
      <div className="design-gallery">
        {designs.map((design) => (
          <div
            key={design.id}
            className={`design-card ${design.is_active ? 'active' : ''}`}
            onClick={() => setActive(design.id)}
          >
            <img src={design.preview_url} alt={design.name} />
            <div className="design-info">
              <h4>{design.name}</h4>
              <span className="category">{design.category}</span>
              {design.is_active && (
                <span className="badge">Activo</span>
              )}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
```

---

## üìã Workflow para Eventos

### Antes del Evento

1. **Crear dise√±o** en Photoshop/Canva
   - Dimensiones: 600x450px @ 300 DPI
   - Incluir: nombre, fecha, decoraci√≥n
   
2. **Subir dise√±o** a la app
   - Settings ‚Üí Dise√±os ‚Üí Upload
   - Seleccionar categor√≠a
   
3. **Activar dise√±o**
   - Click en el dise√±o deseado
   - Verificar preview

### Durante el Evento

- Cada foto capturada autom√°ticamente usa el dise√±o activo
- Cambiar dise√±o si es necesario (en Settings)

### Despu√©s del Evento

- Dise√±o queda guardado para futuros eventos similares
- Puedes reutilizar dise√±os de eventos pasados

---

## üé® Templates de Dise√±o Incluidos

### Template 1: XV A√±os Elegante

```
Fondo: Gradiente rosa/p√∫rpura
Nombre: Grande, fuente script
Decoraciones: Corona, estrellas
Fecha: Peque√±a, abajo
```

### Template 2: San Valent√≠n

```
Fondo: Rojo/rosa con corazones
Texto: "D√≠a del Amor y la Amistad"
Decoraciones: Corazones, cupido
```

### Template 3: Bodas Cl√°sicas

```
Fondo: Blanco/dorado
Nombres: Tipograf√≠a elegante
Decoraciones: Anillos, flores
Fecha: Cursiva
```

### Template 4: Cumplea√±os Divertido

```
Fondo: Confetti multicolor
Texto: "¬°Feliz Cumplea√±os!"
Nombre + edad
Decoraciones: Globos, pastel
```

---

## ‚úÖ Checklist de Dise√±o

Antes de usar un dise√±o en evento:

- [ ] Dimensiones correctas (600x450px)
- [ ] Resoluci√≥n 300 DPI
- [ ] Texto legible (fuente no muy peque√±a)
- [ ] Colores contrastantes
- [ ] Sin errores ortogr√°ficos
- [ ] Decoraciones no interfieren con contenido
- [ ] Test de impresi√≥n realizado

---

## üöÄ Pr√≥ximos Pasos

1. Implementar sistema de upload
2. Crear galer√≠a de dise√±os
3. Integrar con composici√≥n de tiras
4. Crear 5-10 templates base
5. Testing con impresi√≥n real

---

**¬°Tu ejemplo "LIZ" ser√° el modelo perfecto!** üé®
